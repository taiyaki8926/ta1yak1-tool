

# This file was *autogenerated* from the file RSA_sage.sage
from sage.all_cmdline import *   # import sage library

_sage_const_2 = Integer(2); _sage_const_0p3 = RealNumber('0.3'); _sage_const_0 = Integer(0); _sage_const_1 = Integer(1); _sage_const_91228313843871422767839961657666790992268686181318288926107142629455536678341935900541382795206832349055585535906809836634229957830715848801103620493532865352996568386538805904907414117294419594023947589369412777921689835783244330332449834233642171173739935465571238598520641743485122408455438394294985480639 = Integer(91228313843871422767839961657666790992268686181318288926107142629455536678341935900541382795206832349055585535906809836634229957830715848801103620493532865352996568386538805904907414117294419594023947589369412777921689835783244330332449834233642171173739935465571238598520641743485122408455438394294985480639); _sage_const_17 = Integer(17); _sage_const_11431345612482449038094888498936316909461350091333222118655485374375384706307876941389738498046341068089191534780236606397204076298227974869985785520393937 = Integer(11431345612482449038094888498936316909461350091333222118655485374375384706307876941389738498046341068089191534780236606397204076298227974869985785520393937); _sage_const_3514670141058599920940442500404554889150141069826897009811842212403284442746185817636482379495201627390855088639977010471092729461125359933776264573183725753359659913176329404374125862300034280900990690348106060362523466667237379073824116366226768297382408622204390184563632005893478202279135233583985544305 = Integer(3514670141058599920940442500404554889150141069826897009811842212403284442746185817636482379495201627390855088639977010471092729461125359933776264573183725753359659913176329404374125862300034280900990690348106060362523466667237379073824116366226768297382408622204390184563632005893478202279135233583985544305)
import sys

def help():
    print("---Tool list---")
    print("coppersmith_given_d(c, e, n, d0) -> m : It is efficient when we know tha partial LSBs of d")


def coppersmith_given_d(c, e, n, d0):
    def partial_p(p0, kbits, n):
        PR = PolynomialRing(Zmod(n), names=('x',)); (x,) = PR._first_ngens(1)
        nbits = n.nbits()

        f = _sage_const_2 **kbits*x + p0
        f = f.monic()
        roots = f.small_roots(X=_sage_const_2 **(nbits//_sage_const_2 -kbits), beta=_sage_const_0p3 )  # find root < 2^(nbits//2-kbits) with factor >= n^0.3
        if roots:
            x0 = roots[_sage_const_0 ]
            p = gcd(_sage_const_2 **kbits*x0 + p0, n)
            return ZZ(p)

    def find_p(d0, kbits, e, n):
        X = var('X')
        for k in range(_sage_const_1 , e+_sage_const_1 ):
            results = solve_mod([e*d0*X - k*X*(n-X+_sage_const_1 ) + k*n == X], _sage_const_2 **kbits)
            for x in results:
                p0 = ZZ(x[_sage_const_0 ])
                try:
                    p = partial_p(p0, kbits, n)
                    if p:
                        return p
                except:
                    pass

    p = find_p(d0, d0.nbits(), e, n)
    q = n//p
    assert(n % p == _sage_const_0 )
    d = pow(e, -_sage_const_1 , (p-_sage_const_1 )*(q-_sage_const_1 ))
    m = pow(c, d, n)
    return m



if __name__ == '__main__':
    # sample
    n = _sage_const_91228313843871422767839961657666790992268686181318288926107142629455536678341935900541382795206832349055585535906809836634229957830715848801103620493532865352996568386538805904907414117294419594023947589369412777921689835783244330332449834233642171173739935465571238598520641743485122408455438394294985480639 
    e = _sage_const_17 
    d0 = _sage_const_11431345612482449038094888498936316909461350091333222118655485374375384706307876941389738498046341068089191534780236606397204076298227974869985785520393937 
    c = _sage_const_3514670141058599920940442500404554889150141069826897009811842212403284442746185817636482379495201627390855088639977010471092729461125359933776264573183725753359659913176329404374125862300034280900990690348106060362523466667237379073824116366226768297382408622204390184563632005893478202279135233583985544305 
    

